(()=>{var e={72:()=>{window.RunNode=class{constructor(e,t){this.node=e,this.context=t}async run(){throw new Error("run() not implemented for base RunNode")}getInputs(){return this.node.inputs?this.node.inputs.map(e=>this.context.getNodeById(e)):[]}getOutputs(){return this.node.outputs?this.node.outputs.map(e=>this.context.getNodeById(e)):[]}setOutputValue(e){window.runtimeState.setNodeState(this.node.id,{outputValue:e})}}},79:()=>{document.addEventListener("DOMContentLoaded",function(){document.getElementById("container").addEventListener("click",function(e){const o=e.target.closest(".card");if(o){const e=o.dataset.id,n=window.nodeData?.find(t=>t.id===e);n&&t(n)}})});let e=null;function t(t){window.currentInspectedNodeId=t.id,document.querySelectorAll(".card.selected").forEach(e=>e.classList.remove("selected")),e=t.id;const o=document.querySelector(`.card[data-id="${t.id}"]`);o&&o.classList.add("selected");let n=JSON.parse(localStorage.getItem("nodes"))||{metadata:{},nodes:window.nodeData};n.metadata.selectedNode=t.id,localStorage.setItem("nodes",JSON.stringify(n)),document.getElementById("inspector-title").innerHTML=`\n        <input id="inspector-label-input" type="text" value="${t.data?.label||t.id}" style="font-size:1.2em; width:90%; padding:4px; border-radius:6px; border:1px solid #888; background:#18192a; color:#fff;">\n    `;const d=window.runtimeState.getNodeState(t.id).cluster,a=window.runtimeState.getNodeState(t.id).sortOrder;document.getElementById("inspector-details").innerHTML=`\n        <p>Cluster: ${d}</p>\n        <p>Sort order: ${a}</p>\n        <p>Node data:</p>\n        <pre>${JSON.stringify(t,null,2)}</pre>\n    `;const i=document.getElementById("inspector-tool-panel");i.innerHTML="",i&&(i.className="",i.classList.add(`node-type-${t.type}`));let s=t.type;function c(){const e=window.inspectorToolPanels[s]||window.inspectorToolPanels[t.type];e&&e(t,i)}if("tool"===t.type&&t.toolType&&(s=`tool:${t.toolType}`),window.inspectorToolPanels[s])c();else if("tool"===t.type&&t.toolType){const e=`inspector-panel-${t.toolType}`;if(document.getElementById(e))setTimeout(c,100);else{const o=document.createElement("script");o.id=e,o.src=`nodeEditor/inspector/inspectorPanelTool_${t.toolType}.js`,o.onload=c,document.body.appendChild(o)}}else if("agent"===t.type){const e="inspector-panel-agent";if(document.getElementById(e))setTimeout(c,100);else{const t=document.createElement("script");t.id=e,t.src="nodeEditor/inspector/inspectorPanelAgent.js",t.onload=c,document.body.appendChild(t)}}else if("broadcaster"===t.type){const e="inspector-panel-broadcaster";if(document.getElementById(e))setTimeout(c,100);else{const t=document.createElement("script");t.id=e,t.src="nodeEditor/inspector/inspectorPanelBroadcaster.js",t.onload=c,document.body.appendChild(t)}}else if("receiver"===t.type){const e="inspector-panel-receiver";if(document.getElementById(e))setTimeout(c,100);else{const t=document.createElement("script");t.id=e,t.src="nodeEditor/inspector/inspectorPanelReceiver.js",t.onload=c,document.body.appendChild(t)}}else if("comment"===t.type){const e="inspector-panel-comment";if(document.getElementById(e))setTimeout(c,100);else{const t=document.createElement("script");t.id=e,t.src="nodeEditor/inspector/inspectorPanelComment.js",t.onload=c,document.body.appendChild(t)}}else c();document.getElementById("inspector-modal").classList.add("active"),document.body.classList.add("inspector-open");const r=document.getElementById("inspector-label-input");r.addEventListener("change",function(){t.data=t.data||{},t.data.label=r.value;const e={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(e)),window.loadNodes&&window.loadNodes()})}window.inspectorToolPanels={},window.inspectorToolPanels.tool=function(e,t){t.innerHTML=`<div style="color:#fff;">Custom Tool Panel for ${e.data?.label||e.id}</div>`},document.getElementById("delete-inspector").onclick=function(){if(!e||!window.nodeData)return;window.nodeData=window.nodeData.filter(t=>t.id!==e),window.nodeData.forEach(t=>{t.inputs=(t.inputs||[]).filter(t=>t!==e),t.outputs=(t.outputs||[]).filter(t=>t!==e)});const t={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(t)),window.loadNodes&&window.loadNodes(),document.getElementById("inspector-modal").classList.remove("active"),document.body.classList.remove("inspector-open"),document.querySelectorAll(".card.selected").forEach(e=>e.classList.remove("selected")),e=null,s()},document.getElementById("close-inspector").onclick=function(){document.getElementById("inspector-modal").classList.remove("active"),document.body.classList.remove("inspector-open"),document.querySelectorAll(".card.selected").forEach(e=>e.classList.remove("selected")),e=null,s()},document.getElementById("run-inspector").onclick=function(){e&&window.nodeData&&window.runNodeCluster(e)},window.showInspector=t,window.updateAgentPanel=function(){const e=document.getElementById("inspector-tool-panel");if(!e)return;const t=window.currentInspectedNodeId,o=window.nodeData?.find(e=>e.id===t);o&&window.inspectorToolPanels.agent&&window.inspectorToolPanels.agent(o,e)};const o=document.getElementById("inspector-modal");o.style.height="45vh";const n=document.createElement("div");n.id="inspector-resize-handle",o.appendChild(n);let d=!1,a=0,i=0;function s(){let e=JSON.parse(localStorage.getItem("nodes"))||{metadata:{},nodes:window.nodeData};e.metadata.selectedNode=null,localStorage.setItem("nodes",JSON.stringify(e))}n.addEventListener("mousedown",function(e){d=!0,a=e.clientY,i=o.offsetHeight,document.body.style.cursor="ns-resize",document.body.style.userSelect="none"}),document.addEventListener("mousemove",function(e){if(!d)return;const t=a-e.clientY;o.style.height=`${i+t}px`}),document.addEventListener("mouseup",function(){d&&(d=!1,document.body.style.cursor="",document.body.style.userSelect="")})},182:()=>{class e extends window.RunNode{async run(){window.sendBroadcastMessage(this.node.data?.broadcastMessage||""),this.setOutputValue(this.node.data?.broadcastMessage||"")}}window.RunBroadcasterNode=e},235:(e,t,o)=>{"use strict";var n=o(538),d=o(751);class a extends window.RunNode{async run(){let e="Hello world!";if(this.node.inputs&&this.node.inputs.length>0){let t="";const o=this.getInputs();for(const e of o)t+=window.runtimeState.getNodeState(e.id)?.outputValue||"";e=t}const t=this.node.data?.model||"gpt-3.5-turbo";let o,a;if("llama-3.2"===t){o="http://localhost:11434/api/chat",payload={model:"llama3.2",messages:[{role:"user",content:e}]};const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});if(t.ok){const o=t.body.getReader(),n=new TextDecoder("utf-8");let d=!1,a="";for(;!d;){const{value:t,done:i}=await o.read();if(d=i,t){const o=n.decode(t,{stream:!0}).split("\n").filter(e=>""!==e.trim());for(const t of o)try{const o=JSON.parse(t);o.message&&o.message.content&&(a+=o.message.content,window.runtimeState.setNodeState(this.node.id,{prompt:e,inference:a}),window.updateAgentPanel())}catch(e){console.error(`Failed to parse line: ${t} with error ${e}`)}}}this.setOutputValue(a)}else{console.error(`Error: ${t.status}`);const e=await t.text();console.error(e)}}else{if("gpt-3.5-turbo"!==t){let e=`Unknown model: ${t}`;throw window.runtimeState.setNodeState(this.node.id,{error:e}),window.updateAgentPanel(),new Error(e)}{o=d.G+"/api/oai1",a=[{role:"user",content:e}];const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n.J},body:JSON.stringify({messages:a})});let i="";if(!t.ok){console.error(`Error: ${t.status}`);let o="";if(console.log(t.status),429===t.status){this.node&&this.node.el&&this.node.el.classList.add("error-badge");const e=document.getElementById("cut-tooltip");e&&(e.textContent="Tokens exhausted! Please wait for tokens to recharge.",e.style.display="block",e.classList.add("shake"),setTimeout(()=>{e.classList.remove("shake")},1e3),setTimeout(()=>{e.style.display="none"},1e4)),o="Tokens exhausted! Please wait for tokens to recharge."}else{const n=await t.text();window.runtimeState.setNodeState(this.node.id,{prompt:e,inference:`API error: ${n}`}),this.setOutputValue(`API error: ${n}`),console.error(n),o=`API error: ${n}`}throw window.runtimeState.setNodeState(this.node.id,{error:o}),window.updateAgentPanel(),new Error(o)}{const o=await t.json();console.log("OpenAI response:",JSON.stringify(o.body,null,2));let n=null;n=o.choices,i=n&&n.length>0?n[0].message?.content||"":o&&o.body&&o.body.error?`Error: ${o.body.error.message||JSON.stringify(o.body.error)}`:JSON.stringify(o,null,2),window.runtimeState.setNodeState(this.node.id,{prompt:e,inference:i,error:void 0}),window.updateAgentPanel(),this.setOutputValue(i),console.log("Token Bucket Info:",o.tokenBucket),window.updateTokenBucketBar(o.tokenBucket)}}}}}window.RunAgentNode=a},250:()=>{window.DropdownMenu=class{constructor({trigger:e,options:t,container:o=document.body,zIndex:n=9999}){this.trigger=e,this.options=t,this.container=o,this.zIndex=n,this.menu=this._createMenu(),this._bindEvents()}_createMenu(e=this.options,t=null){const o=document.createElement("div");return o.className="dropdown-menu",o.style.zIndex=this.zIndex,e.forEach(e=>{const t=document.createElement("button");if(t.className="dropdown-menu-option",t.textContent=e.label,t.id=e.id||"",t.onclick=t=>{this._hideAllMenus(),"function"==typeof e.onClick&&e.onClick(t)},o.appendChild(t),e.submenu&&Array.isArray(e.submenu)){t.classList.add("has-submenu");const n=this._createMenu(e.submenu,o);n.style.display="none",n.style.position="absolute",n.style.left="100%",n.style.top=t.offsetTop+"px",o.appendChild(n),t.addEventListener("mouseenter",()=>{const e=t.getBoundingClientRect(),d=o.getBoundingClientRect();n.style.left=e.right-d.left+"px",n.style.top=t.offsetTop+"px",n.style.display="block"}),t.addEventListener("mouseleave",()=>{setTimeout(()=>{n.matches(":hover")||(n.style.display="none")},150)}),n.addEventListener("mouseleave",()=>{n.style.display="none"})}}),t||this.container.appendChild(o),o}_bindEvents(){this.trigger.addEventListener("click",e=>{e.stopPropagation(),this.show()}),document.addEventListener("mousedown",e=>{this.menu.contains(e.target)||e.target===this.trigger||this._hideAllMenus()})}_hideAllMenus(){this.container.querySelectorAll(".dropdown-menu").forEach(e=>{e.style.display="none"})}show(){const e=this.trigger.getBoundingClientRect();this.menu.style.left=e.left+"px",this.menu.style.top=e.bottom+4+"px",this.menu.style.display="block",this.menu.querySelectorAll(".dropdown-menu").forEach(e=>e.style.display="none")}hide(){this.menu.style.display="none"}destroy(){this.menu.remove()}}},331:()=>{window.setScratchCostumeName=function(e,t){try{if(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets){const o=window.scaffolding.vm.runtime.targets;for(const n of o)if(n.getName()===e&&Array.isArray(n.getCostumes())){const e=n.getCostumes().findIndex(e=>e.name===t);if(-1!==e)return n.currentCostume=e,n.setCostume(e),!0}}}catch(e){console.error("Error setting costume:",e)}return!1},window.waitForVMAndUpdate=function(e,t,o=0){if("function"==typeof window.checkVMReady&&window.checkVMReady()){let o=[];"function"==typeof e&&(o=e()),t(o)}else setTimeout(()=>window.waitForVMAndUpdate(e,t,o+1),100)},window.getScratchCurrentCostumeName=function(e,t){if(window.scaffolding&&window.scaffolding.vm&&"function"==typeof window.scaffolding.vm.toJSON){let o,n=window.scaffolding.vm.toJSON();if("string"==typeof n)o=JSON.parse(n);else if(n instanceof ArrayBuffer||n instanceof Uint8Array){const e=(new TextDecoder).decode(n);o=JSON.parse(e)}else o=n;if(o.targets)for(const n of o.targets)if(n.name===e){if(n.isStage&&Array.isArray(n.costumes)&&"number"==typeof n.currentCostume){const e=n.costumes[n.currentCostume];if(e&&e.name)return void t(e.name)}if(!n.isStage&&Array.isArray(n.costumes)&&"number"==typeof n.currentCostume){const e=n.costumes[n.currentCostume];if(e&&e.name)return void t(e.name)}}t("no costume found")}else console.warn("Scratch VM or toJSON() not available")},window.getScratchTargetNames=function(){let e=[];try{if(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets){const t=window.scaffolding.vm.runtime.targets;for(const o of t)o&&o.sprite&&o.sprite.name?e.push(o.sprite.name):(o&&o.isStage&&!0===o.isStage&&o.name||o&&o.name)&&e.push(o.name)}}catch(e){}return Array.from(new Set(e))},window.checkVMReady=function(){return!!(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets&&window.scaffolding.vm.runtime.targets.length>0)},window.getScratchVariableNames=function(){let e=[];try{if(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets){const t=window.scaffolding.vm.runtime.targets;for(const o of t)if(o.variables)for(const[t,n]of Object.entries(o.variables)){let t=n.name||(Array.isArray(n)?n[0]:void 0);!t||""!==n.type&&"list"!==n.type&&void 0!==n.type||e.push(t)}}}catch(e){}return Array.from(new Set(e))},window.getScratchBroadcastNames=function(){let e=[];try{if(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets){const t=window.scaffolding.vm.runtime.targets;for(const o of t)if(o.variables)for(const[t,n]of Object.entries(o.variables)){let t=n.name||(Array.isArray(n)?n[0]:void 0);t&&"broadcast_msg"===n.type&&e.push(t)}}}catch(e){}return Array.from(new Set(e))},window.reloadScratchIframe=function(e){const t=document.getElementById("scratch-iframe");t&&(t.src="",setTimeout(()=>{t.src=`projectPlayer.html#${e}`},10))},document.getElementById("load-scratch-project").onclick=function(){let e=document.getElementById("scratch-project-id").value.trim().match(/(\d{5,})/);if(!e)return void alert("Please enter a valid Scratch project ID or URL.");const t=e[1];if(localStorage.setItem("lastScratchProjectId",t),window.lastScratchProjectId=t,window.nodeData){const e={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(e))}window.reloadScratchIframe(t)},window.addEventListener("DOMContentLoaded",function(){let e=null;const t=localStorage.getItem("nodes");if(t)try{const o=JSON.parse(t);e=o.metadata?.lastScratchProjectId||null}catch(e){}e||(e=localStorage.getItem("lastScratchProjectId")),e&&(document.getElementById("scratch-project-id").value="scratch.mit.edu/projects/"+e,window.lastScratchProjectId=e,window.reloadScratchIframe(e))}),document.getElementById("GreenFlagBtn").onclick=function(){const e=document.getElementById("scratch-iframe");e&&e.contentWindow&&"function"==typeof e.contentWindow.start?e.contentWindow.start():e&&e.contentWindow&&e.contentWindow.postMessage({type:"start"},"*"),e&&e.focus()},document.getElementById("StopBtn").onclick=function(){const e=document.getElementById("scratch-iframe");e&&e.contentWindow&&"function"==typeof e.contentWindow.stop?e.contentWindow.stop():e&&e.contentWindow&&e.contentWindow.postMessage({type:"stop"},"*"),e&&e.focus()};const e=document.getElementById("scratch-iframe");e.addEventListener("load",function(){if(e.contentWindow&&e.contentWindow.scaffolding)window.scaffolding=e.contentWindow.scaffolding;else{const t=setInterval(()=>{e.contentWindow&&e.contentWindow.scaffolding&&(window.scaffolding=e.contentWindow.scaffolding,clearInterval(t))},100)}}),window.getScratchVariableValue=function(e){if(!e)return"";try{if(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets){const t=window.scaffolding.vm.runtime.targets;for(const o of t)if(o.variables)for(const[t,n]of Object.entries(o.variables)){let t=n.name||(Array.isArray(n)?n[0]:void 0);if(t&&t.toLowerCase()===e.toLowerCase())return void 0!==n.value?n.value:Array.isArray(n)?n[1]:""}}}catch(e){return"(error reading variable)"}return""},window.setScratchVariableValue=function(e,t){if(e&&void 0!==t)try{if(window.scaffolding&&window.scaffolding.vm&&window.scaffolding.vm.runtime&&window.scaffolding.vm.runtime.targets){const o=window.scaffolding.vm.runtime.targets;for(const n of o)if(n.variables)for(const[o,d]of Object.entries(n.variables)){let o=d.name||(Array.isArray(d)?d[0]:void 0);if(o&&o.toLowerCase()===e.toLowerCase())return void(d.value=t)}}}catch(e){console.error("Error setting variable:",e)}},window.addEventListener("message",e=>{"scratchBroadcast"===e.data.type&&console.log("Broadcast from inside iframe:",e.data.message)}),window.sendBroadcastMessage=function(e){const t=document.getElementById("scratch-iframe");t&&t.contentWindow?t.contentWindow.postMessage({type:"triggerScratchBroadcast",message:e},"*"):console.warn("Scratch iframe not found or not loaded.")}},433:()=>{function e(e){let t=e||null;if(!t)try{t=JSON.parse(localStorage.getItem("nodes"))}catch(e){t=null}if(!t||!t.metadata||null==t.metadata.selectedNode){const e=document.getElementById("inspector-modal");e&&(e.classList.remove("active"),document.body.classList.remove("inspector-open"),document.querySelectorAll(".card.selected").forEach(e=>e.classList.remove("selected")))}if(!t||!t.metadata||null==t.metadata.lastScratchProjectId){const e=document.getElementById("scratch-project-id");e&&(e.value="scratch.mit.edu/projects/1197188623"),window.reloadScratchIframe&&window.reloadScratchIframe("1197188623")}const o=document.getElementById("json-modal-project-name");if(o){let e=t&&t.metadata&&t.metadata.projectName?t.metadata.projectName:"Untitled MEW Project";o.value=e}}window.addEventListener("DOMContentLoaded",function(){try{const e=JSON.parse(localStorage.getItem("nodes"));e&&e.nodes&&0!==e.nodes.length||window.loadBlankProject()}catch(e){window.loadBlankProject()}const t=document.getElementById("load-nodes");new DropdownMenu({trigger:t,options:[{label:"New empty project",id:"dropdown-new-empty",onClick:function(){window.loadBlankProject()}},{label:"Load demo",id:"dropdown-load-demo",submenu:[{label:"Starter Demo",id:"dropdown-demo-default",onClick:function(){fetch("/demoProjects/starter-demo.json").then(e=>e.json()).then(t=>{t.metadata||(t.metadata={}),t.metadata.projectName||(t.metadata.projectName="Untitled MEW Project"),localStorage.setItem("nodes",JSON.stringify(t)),window.loadNodes(),e(t)})}},{label:"BMO Chatbot Demo",id:"dropdown-demo-bmo",onClick:function(){fetch("/demoProjects/bmo-chatbot-demo.json").then(e=>e.json()).then(t=>{t.metadata||(t.metadata={}),t.metadata.projectName||(t.metadata.projectName="Untitled MEW Project"),localStorage.setItem("nodes",JSON.stringify(t)),window.loadNodes(),e(t)})}},{label:"Rock Paper Scissors Demo",id:"dropdown-demo-rps",onClick:function(){fetch("/demoProjects/rock-paper-scissors-demo.json").then(e=>e.json()).then(t=>{t.metadata||(t.metadata={}),t.metadata.projectName||(t.metadata.projectName="Rock Paper Scissors Demo"),localStorage.setItem("nodes",JSON.stringify(t)),window.loadNodes(),e(t)})}}]},{label:"Load from file",id:"dropdown-load-file",onClick:function(){const t=document.createElement("input");t.type="file",t.accept=".json,.txt,application/json,text/plain",t.onchange=function(t){const o=t.target.files[0];if(!o)return;const n=new FileReader;n.onload=function(t){try{const o=JSON.parse(t.target.result);o.metadata||(o.metadata={}),o.metadata.projectName||(o.metadata.projectName="Untitled MEW Project"),localStorage.setItem("nodes",JSON.stringify(o)),window.loadNodes(),e(o);const n=o?.metadata?.lastScratchProjectId;n&&window.reloadScratchIframe&&setTimeout(()=>{window.reloadScratchIframe(n)},300)}catch(e){alert("Invalid file format!")}},n.readAsText(o)},t.click()}},{label:"Load from txt",id:"dropdown-load-txt",onClick:function(){document.getElementById("load-project-modal").style.display="flex"}}],container:document.body,zIndex:9999})}),window.loadBlankProject=function(){const t={nodes:[],metadata:{lastScratchProjectId:"1197188623",projectName:"Untitled MEW Project"}};localStorage.setItem("nodes",JSON.stringify(t)),window.loadNodes(),e(t)}},438:()=>{document.getElementById("close-load-project").onclick=function(){document.getElementById("load-project-modal").style.display="none"},document.getElementById("load-project-confirm").onclick=function(){try{const e=document.getElementById("load-project-text").value,t=JSON.parse(e);localStorage.setItem("nodes",JSON.stringify(t)),window.loadNodes(),document.getElementById("load-project-modal").style.display="none"}catch(e){alert("Invalid project data!")}}},439:()=>{class e extends window.RunNode{async run(){let e="";if(this.node.inputs&&this.node.inputs.length>0){const t=this.getInputs();for(const o of t)"receiver"!==o.type?e+=window.runtimeState.getNodeState(o.id)?.outputValue||"":e=this.node.data?.notepadContent||"";this.node.data.notepadContent=e}else e=this.node.data?.notepadContent||"";this.setOutputValue(e)}}window.RunTextNode=e},457:()=>{window.initDragAndDrop=function(){let e=0,t=0,o=0,n=0;const d=document.getElementsByClassName("card");Array.from(d).forEach(d=>{d.onmousedown=function(a){o=a.clientX,n=a.clientY,document.onmousemove=function(a){if(e=o-a.clientX,t=n-a.clientY,o=a.clientX,n=a.clientY,d.style.top=d.offsetTop-t+"px",d.style.left=d.offsetLeft-e+"px",window.nodeData){const e=d.dataset.id,t=window.nodeData.find(t=>t.id===e);if(t){t.position={top:parseInt(d.style.top,10),left:parseInt(d.style.left,10)};const e={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(e))}}window.updateConnections&&window.updateConnections()},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}})},window.initDragAndDrop()},508:()=>{class e extends window.RunNode{async run(){let e="";if(this.node.inputs&&this.node.inputs.length>0){const t=this.getInputs();if(t.every(e=>"receiver"===e.type))e=getScratchVariableValue(this.node.data?.variableName||"");else{for(const o of t)e+=window.runtimeState.getNodeState(o.id)?.outputValue||"";setScratchVariableValue(this.node.data?.variableName||"",e)}}else e=getScratchVariableValue(this.node.data?.variableName||"");this.setOutputValue(e)}}window.RunVariableNode=e},538:(e,t,o)=>{"use strict";o.d(t,{J:()=>n});let n=localStorage.getItem("agentUserId");n||(n=crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),localStorage.setItem("agentUserId",n)),window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("userID");e&&(e.textContent=n)})},548:()=>{let e=!1,t=null,o=null;function n(t){if(!e||!o)return;const n=document.getElementById("connections"),d=n.getContext("2d");window.updateConnections();const a=o.from.getBoundingClientRect(),i=n.getBoundingClientRect(),s=a.left+a.width/2-i.left,c=a.top+a.height/2-i.top,r=t.clientX-i.left,l=t.clientY-i.top;d.beginPath(),d.moveTo(s,c);const u=.5*Math.abs(r-s);d.bezierCurveTo(s+u,c,r-u,l,r,l),d.strokeStyle="#ffab19",d.lineWidth=2,d.setLineDash([5,5]),d.stroke(),d.setLineDash([])}function d(){e=!1,t=null,a(),document.body.style.cursor="",document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",d),document.querySelectorAll(".node-point.active").forEach(e=>e.classList.remove("active"))}function a(){window.updateConnections&&window.updateConnections()}window.setupConnectionEvents=function(){const i=document.getElementById("container"),s=document.querySelectorAll(".output-point"),c=document.querySelectorAll(".input-point");s.forEach(a=>{a.onmousedown=function(s){s.stopPropagation(),e=!0,t=a.parentElement.dataset.id,a.classList.add("active"),document.body.style.cursor="grabbing",o={from:a,x:s.clientX,y:s.clientY},i.addEventListener("mousemove",n),document.addEventListener("mousemove",n),document.addEventListener("mouseup",d)},a.onmouseenter=function(){e&&a.classList.add("active")},a.onmouseleave=function(){e||a.classList.remove("active")}}),c.forEach(o=>{o.onmouseenter=function(){e&&o.classList.add("active")},o.onmouseleave=function(){e&&o.classList.remove("active")},o.onmouseup=function(n){if(!e||!t)return;const d=window.nodeData.find(e=>e.id===t),i=window.nodeData.find(e=>e.id===o.parentElement.dataset.id);if(d&&i&&d.id!==i.id){if(!d.outputs.includes(i.id)){d.outputs.push(i.id),i.inputs=i.inputs||[],i.inputs.includes(d.id)||i.inputs.push(d.id);const e={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(e)),window.updateConnections&&window.updateConnections()}if("function"==typeof window.showInspector&&window.currentInspectedNodeId&&window.nodeData){const e=window.nodeData.find(e=>e.id===window.currentInspectedNodeId);e&&window.showInspector(e)}}o.classList.add("active"),setTimeout(()=>{o.classList.remove("active")},300),e=!1,t=null,a(),document.querySelectorAll(".node-point.active").forEach(e=>{e!==o&&e.classList.remove("active")})}})}},690:()=>{window.cutMode=!1,window.hoveredConnection=null;const e=document.getElementById("cut");function t(t){window.cutMode=t,t?(document.body.classList.add("cut-mode"),e.textContent="Exit Cut Mode",document.getElementById("cut-tooltip").style.display="block",document.getElementById("cut-tooltip").textContent="Cut mode: Click on something to remove it. Press Escape to exit."):(document.body.classList.remove("cut-mode"),e.textContent="Cut Mode",document.getElementById("cut-tooltip").style.display="none",window.hoveredConnection=null,window.updateConnections&&window.updateConnections())}e.onclick=function(){t(!window.cutMode)},document.addEventListener("keydown",function(e){window.cutMode&&"Escape"===e.key&&t(!1)});var o=window.canvas||document.getElementById("connections");window.canvas=o,o.addEventListener("mousemove",function(e){if(!window.cutMode)return;const t=o.getBoundingClientRect(),n=e.clientX-t.left,d=e.clientY-t.top;let a=null,i=16;(window.nodeData||[]).forEach(e=>{const t=document.querySelector(`.card[data-id="${e.id}"] .output-point`);t&&(e.outputs||[]).forEach(s=>{const c=document.querySelector(`.card[data-id="${s}"] .input-point`);if(!c)return;const r=t.getBoundingClientRect(),l=c.getBoundingClientRect(),u=o.getBoundingClientRect(),w=r.left+r.width/2-u.left,m=r.top+r.height/2-u.top,f=l.left+l.width/2-u.left,p=l.top+l.height/2-u.top,h=function(e,t,o,n,d,a){const i=d-o,s=a-n,c=i*i+s*s;let r,l,u=-1;0!==c&&(u=((e-o)*i+(t-n)*s)/c),u<0?(r=o,l=n):u>1?(r=d,l=a):(r=o+u*i,l=n+u*s);const w=e-r,m=t-l;return Math.sqrt(w*w+m*m)}(n,d,w,m,f,p);h<i&&(i=h,a={from:e.id,to:s})})}),window.hoveredConnection=a,window.updateConnections&&window.updateConnections()}),o.addEventListener("click",function(e){if(!window.cutMode||!window.hoveredConnection)return;const{from:t,to:o}=window.hoveredConnection,n=window.nodeData.find(e=>e.id===t);n&&(n.outputs=(n.outputs||[]).filter(e=>e!==o));const d=window.nodeData.find(e=>e.id===o);d&&(d.inputs=(d.inputs||[]).filter(e=>e!==t));const a={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};if(localStorage.setItem("nodes",JSON.stringify(a)),window.hoveredConnection=null,window.loadNodes&&window.loadNodes(),window.updateConnections&&window.updateConnections(),"function"==typeof window.showInspector&&window.currentInspectedNodeId&&window.nodeData){const e=window.nodeData.find(e=>e.id===window.currentInspectedNodeId);e&&window.showInspector(e)}});let n=null;document.getElementById("container").addEventListener("mousemove",function(e){if(!window.cutMode)return;if(window.hoveredConnection)return void(n&&(n.classList.remove("cut-hover"),n=null));const t=e.target.closest(".card");n&&n!==t&&(n.classList.remove("cut-hover"),n=null),t&&(t.classList.add("cut-hover"),n=t)}),document.getElementById("container").addEventListener("mouseleave",function(){n&&(n.classList.remove("cut-hover"),n=null)});const d=t;t=function(e){d(e),e||n&&(n.classList.remove("cut-hover"),n=null)},document.getElementById("container").addEventListener("click",function(e){if(!window.cutMode)return;if(window.hoveredConnection)return;const t=e.target.closest(".card");if(t&&t.dataset.id){const e=t.dataset.id;window.nodeData=window.nodeData.filter(t=>t.id!==e),window.nodeData.forEach(t=>{t.inputs=(t.inputs||[]).filter(t=>t!==e),t.outputs=(t.outputs||[]).filter(t=>t!==e)});const o={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(o)),window.loadNodes&&window.loadNodes(),window.updateConnections&&window.updateConnections()}})},695:()=>{class e extends window.RunNode{async run(){this.setOutputValue("")}}window.RunCommentNode=e},751:(e,t,o)=>{"use strict";o.d(t,{G:()=>n});const n="https://multiagent-exploration-workbench-c8htdxerg6d9faa0.uksouth-01.azurewebsites.net"},757:()=>{class e extends window.RunNode{async run(){this.setOutputValue("")}}window.RunReceiverNode=e},758:(e,t,o)=>{"use strict";var n=o(862);function d(e){const t=document.getElementById("container");Array.from(document.getElementsByClassName("card")).forEach(e=>e.remove()),e.forEach(e=>{const o=document.createElement("div");o.className=`card ${e.type}`,o.dataset.id=e.id;let n="",d="";if("agent"===e.type?n="🤖":"tool"===e.type?"variable"===e.toolType?(n="🔢",d="#ff8c17"):"notepad"===e.toolType?(n="📝",d="#5ac05b"):"costume"===e.toolType?(n="🎭",d="#9965ff"):(n="🛠️",d="#5abd13"):n="receiver"===e.type?"📥":"broadcaster"===e.type?"📢":"🔹",e.data&&e.data.icon&&(n=e.data.icon),o.innerHTML=`\n            \x3c!-- <span class="node-icon">${n}</span> --\x3e\n            <span class="node-label">${e.data.label||e.id}</span>\n        `,"tool"===e.type&&d&&(o.style.backgroundColor=d,o.style.borderRadius="10px"),"tool"===e.type&&e.toolType&&o.setAttribute("data-tool-type",e.toolType),"receiver"===e.type){const e=document.createElement("div");e.className="node-point output-point",e.title="Output",o.appendChild(e)}else if("broadcaster"===e.type){const e=document.createElement("div");e.className="node-point input-point",e.title="Input",o.appendChild(e)}else if("comment"===e.type);else{const e=document.createElement("div");e.className="node-point input-point",e.title="Input",o.appendChild(e);const t=document.createElement("div");t.className="node-point output-point",t.title="Output",o.appendChild(t)}e.position&&"number"==typeof e.position.top&&"number"==typeof e.position.left?(o.style.top=`${e.position.top}px`,o.style.left=`${e.position.left}px`):(o.style.top=100+300*Math.random()+"px",o.style.left=100+500*Math.random()+"px"),t.appendChild(o)}),window.initDragAndDrop&&window.initDragAndDrop(),window.initConnections&&window.initConnections(e),window.setupConnectionEvents&&window.setupConnectionEvents()}window.loadNodes=function(){let e;const t=localStorage.getItem("nodes");if(t)try{e=JSON.parse(t)}catch(t){e=null}if(e&&e.nodes){if(window.lastScratchProjectId=e.metadata?.lastScratchProjectId||null,d(e.nodes),window.nodeData=e.nodes,window.nodeData.forEach(e=>{"receiver"===e.type&&(0,n.l)(e)}),window.lastScratchProjectId){"function"==typeof window.reloadScratchIframe&&window.reloadScratchIframe(window.lastScratchProjectId);const e=document.getElementById("scratch-project-id");e&&(e.value="scratch.mit.edu/projects/"+window.lastScratchProjectId)}const t=e.metadata?.selectedNode||null;if(t){const e=window.nodeData.find(e=>e.id===t);e&&window.showInspector&&setTimeout(()=>window.showInspector(e),100)}}else console.log("No saved nodes found in localStorage, loading blank"),fetch("data.json").then(e=>e.json()).then(e=>{if(window.lastScratchProjectId=e.metadata?.lastScratchProjectId||null,d(e.nodes),window.nodeData=e.nodes,window.nodeData.forEach(e=>{"receiver"===e.type&&(0,n.l)(e)}),localStorage.setItem("nodes",JSON.stringify(e)),window.lastScratchProjectId){"function"==typeof window.reloadScratchIframe&&window.reloadScratchIframe(window.lastScratchProjectId);const e=document.getElementById("scratch-project-id");e&&(e.value="scratch.mit.edu/projects/"+window.lastScratchProjectId)}const t=e.metadata?.selectedNode||null;if(t){const e=window.nodeData.find(e=>e.id===t);e&&window.showInspector&&setTimeout(()=>window.showInspector(e),100)}})},window.updateNodeRunStatusBadge=function(e){const t=document.querySelector(`.card[data-id="${e.id}"]`);if(!t)return;let o=t.querySelector(".run-status-badge");o||(o=document.createElement("div"),o.className="run-status-badge",t.appendChild(o));let n=null,d="",a="",i="none";window.runtimeState&&"function"==typeof window.runtimeState.getNodeState&&(n=window.runtimeState.getNodeState(e.id).runStatus||null),"queued"===n?(d='\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hourglass-icon lucide-hourglass"><path d="M5 22h14"/><path d="M5 2h14"/><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"/><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2"/></svg>',a="#999999",i="flex"):"running"===n?(d='\n<svg class="spin" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw-icon lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>',a="#5269ff",i="flex"):"error"===n?(d='\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-octagon-x-icon lucide-octagon-x"><path d="m15 9-6 6"/><path d="M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z"/><path d="m9 9 6 6"/></svg>',a="#ff5a5a",i="flex"):"complete"===n&&(d='\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="margin-top:2px;" class="lucide lucide-check-icon lucide-check"><path d="M20 6 9 17l-5-5"/></svg>',a="#5ac05b",i="flex"),o.style.display=i,o.style.background=a,o.innerHTML=d}},770:()=>{var e=window.canvas||document.getElementById("connections");window.canvas=e;const t=e.getContext("2d");function o(){const e=document.getElementById("container"),t=document.getElementById("connections");t.width=e.scrollWidth,t.height=e.scrollHeight,window.updateConnections&&window.updateConnections()}o(),window.addEventListener("resize",o);let n=[],d={};window.initConnections=function(e){n=e,window.nodeData=n,d={},e.forEach(e=>{d[e.id]=document.querySelector(`.card[data-id="${e.id}"]`)}),window.updateConnections()},window.updateConnections=function(){if(t.clearRect(0,0,e.width,e.height),n.forEach(o=>{const n=d[o.id];if(!n)return;const a=n.querySelector(".output-point");o.outputs.forEach(n=>{const i=d[n];if(!i)return;const s=i.querySelector(".input-point"),c=a.getBoundingClientRect(),r=s.getBoundingClientRect(),l=e.getBoundingClientRect(),u=c.left+c.width/2-l.left,w=c.top+c.height/2-l.top,m=r.left+r.width/2-l.left,f=r.top+r.height/2-l.top;t.beginPath(),t.moveTo(u,w);const p=.5*Math.abs(m-u);t.bezierCurveTo(u+p,w,m-p,f,m,f);let h=!1;window.cutMode&&window.hoveredConnection&&(h=window.hoveredConnection.from===o.id&&window.hoveredConnection.to===n),h?(t.strokeStyle="#ff5a5a",t.setLineDash([6,6]),t.lineWidth=3):(t.strokeStyle="white",t.setLineDash([]),t.lineWidth=2),t.stroke(),t.setLineDash([]);const g=u+p,y=w,v=m-p,S=f;function I(e,t,o,n,d){const a=1-e;return a*a*a*t+3*a*a*e*o+3*a*e*e*n+e*e*e*d}function E(e,t,o,n,d){const a=1-e;return 3*a*a*(o-t)+6*a*e*(n-o)+3*e*e*(d-n)}let N=u,b=w,k=0;const B=[{x:u,y:w,t:0}];for(let e=1;e<=50;e++){const t=e/50,o=I(t,u,g,v,m),n=I(t,w,y,S,f);k+=Math.hypot(o-N,n-b),B.push({x:o,y:n,t}),N=o,b=n}let C=Math.floor(B.length/2),j=B[C].t,x=j,L=0;for(let e=C;e<B.length-1;e++)if(L+=Math.hypot(B[e+1].x-B[e].x,B[e+1].y-B[e].y),L>=10){x=B[e+1].t;break}const P=I(x,u,g,v,m),M=I(x,w,y,S,f),T=E(x,u,g,v,m),O=E(x,w,y,S,f),D=Math.atan2(O,T),R=I(j,u,g,v,m),A=I(j,w,y,S,f),J=D+Math.PI/2,$=R+6*Math.cos(J),V=A+6*Math.sin(J),W=R-6*Math.cos(J),q=A-6*Math.sin(J);t.beginPath(),t.moveTo(P,M),t.lineTo($,V),t.lineTo(W,q),t.closePath(),t.fillStyle=h?"#ff5a5a":"white",t.fill()})}),window.currentInspectedNodeId&&window.nodeData){const e=window.nodeData.find(e=>e.id===window.currentInspectedNodeId);e&&"function"==typeof window.showInspector&&window.showInspector(e)}}},794:()=>{function e(e,t){if(!window.nodeData)return;const o=`${e}${Date.now()}`,n={top:100+100*Math.random(),left:100+100*Math.random()};let d={id:o,type:e,toolType:t||null,inputs:[],outputs:[],data:{label:t?t.charAt(0).toUpperCase()+t.slice(1)+" Tool":e.charAt(0).toUpperCase()+e.slice(1),..."agent"===e?{model:"gpt-3.5-turbo"}:{}},position:n};"receiver"===e?d.outputs=[]:"broadcaster"===e?d.inputs=[]:"comment"===e&&(d.data.markdown=""),window.nodeData.push(d);const a={metadata:{lastScratchProjectId:window.lastScratchProjectId||null},nodes:window.nodeData};localStorage.setItem("nodes",JSON.stringify(a)),window.loadNodes&&window.loadNodes()}document.getElementById("new-agent").onclick=function(){e("agent")},document.getElementById("new-receiver").onclick=function(){e("receiver")},document.getElementById("new-broadcaster").onclick=function(){e("broadcaster")},document.getElementById("new-variable-tool").onclick=function(){e("tool","variable")},document.getElementById("new-notepad-tool").onclick=function(){e("tool","notepad")},document.getElementById("new-costume-tool").onclick=function(){e("tool","costume")},document.getElementById("new-comment").onclick=function(){e("comment")}},824:()=>{document.getElementById("save-nodes").onclick=function(){if(window.nodeData){let e=null,t="";try{const o=JSON.parse(localStorage.getItem("nodes"));e=o?.metadata?.selectedNode||null,t=o?.metadata?.projectName||""}catch(e){}t||(t="Untitled MEW Project");const o=document.getElementById("json-modal-project-name");o&&(o.value=t);const n={metadata:{lastScratchProjectId:window.lastScratchProjectId||null,selectedNode:e,projectName:t},nodes:window.nodeData},d=JSON.stringify(n,null,2);document.getElementById("json-modal-text").value=d,document.getElementById("json-modal").style.display="flex",o&&(o.oninput=function(){try{let e=JSON.parse(localStorage.getItem("nodes"));if(!e)return;e.metadata=e.metadata||{},e.metadata.projectName=o.value,localStorage.setItem("nodes",JSON.stringify(e)),document.getElementById("json-modal-text").value=JSON.stringify(e,null,2)}catch(e){}})}},document.getElementById("close-json-modal").onclick=function(){document.getElementById("json-modal").style.display="none"},document.getElementById("copy-json-modal").onclick=function(){const e=document.getElementById("json-modal-text");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy")},document.getElementById("download-json-modal").onclick=function(){const e=document.getElementById("json-modal-text"),t=document.getElementById("json-modal-project-name");let o=t&&t.value.trim()?t.value.trim():"Untitled MEW Project",n={};try{n=JSON.parse(e.value)}catch(e){n={}}n.metadata||(n.metadata={}),n.metadata.projectName=o;const d=JSON.stringify(n,null,2);e.value=d;let a=o.replace(/[^a-zA-Z0-9-_ ]/g,"").replace(/\s+/g,"_");a||(a="MEW_Project"),a+=".json";const i=new Blob([d],{type:"application/json"}),s=URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download=a,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),URL.revokeObjectURL(s)},100)}},862:(e,t,o)=>{"use strict";function n(e){if(e._currentBroadcastListener&&window.removeEventListener("message",e._currentBroadcastListener),e.data&&e.data.receiverMessage){const t=e.data.receiverMessage,o=function(o){"scratchBroadcast"===o.data.type&&o.data.message===t&&(console.log(`[Node ${e.id}] received broadcast:`,t),window.runNodeCluster(e.id))};window.addEventListener("message",o),e._currentBroadcastListener=o}}o.d(t,{l:()=>n}),window.setupReceiverNode=n},876:()=>{class e extends window.RunNode{async run(){let e="";const t=this.node.data?.spriteName||"";if(this.node.inputs&&this.node.inputs.length>0){const o=this.getInputs();if(o.every(e=>"receiver"===e.type))await new Promise(o=>{window.getScratchCurrentCostumeName(t,t=>{e=t||"",o()})});else{for(const t of o)e+=window.runtimeState.getNodeState(t.id)?.outputValue||"";"function"==typeof window.setScratchCostumeName&&window.setScratchCostumeName(t,e)}}else await new Promise(o=>{window.getScratchCurrentCostumeName(t,t=>{e=t||"",o()})});this.setOutputValue(e)}}window.RunCostumeNode=e},885:()=>{const e={nodesState:{},getNodeById:e=>window.nodeData.find(t=>t.id===e),setNodeState(e,t){this.nodesState[e]||(this.nodesState[e]={}),Object.assign(this.nodesState[e],t)},getNodeState(e){return this.nodesState[e]||{}}};function t(t){switch(t.type){case"tool":if("variable"===t.toolType)return new window.RunVariableNode(t,e);if("notepad"===t.toolType)return new window.RunTextNode(t,e);if("costume"===t.toolType)return new window.RunCostumeNode(t,e);break;case"agent":return new window.RunAgentNode(t,e);case"receiver":return new window.RunReceiverNode(t,e);case"broadcaster":return new window.RunBroadcasterNode(t,e);case"comment":return new window.RunCommentNode(t,e);default:return new window.RunNode(t,e)}}function o(e){const t=[],o=new Set,n=new Set,d=Object.fromEntries(e.map(e=>[e.id,e]));function a(e){if(!o.has(e.id)){if(n.has(e.id))throw new Error("Cycle detected in node graph!");n.add(e.id);for(const t of e.inputs||[])d[t]&&a(d[t]);n.delete(e.id),o.add(e.id),t.push(e)}}for(const t of e)o.has(t.id)||a(t);return t}window.runtimeState=e,window.runNodeCluster=async function(n){const d=function(e){const t=new Set,o=[];function n(o,d){t.add(o.id),d.push(o);const a=[...o.inputs||[],...o.outputs||[]].map(t=>e.find(e=>e.id===t)).filter(Boolean);for(const e of a)t.has(e.id)||n(e,d)}for(const d of e)if(!t.has(d.id)){const e=[];n(d,e),o.push(e)}return o}(window.nodeData),a=d.findIndex(e=>e.some(e=>e.id===n)),i={};if(d.forEach((t,n)=>{o(t).forEach((t,o)=>{i[t.id]={cluster:n,sortOrder:o},e.setNodeState(t.id,{cluster:n,sortOrder:o})})}),d.forEach((t,n)=>{o(t).forEach((t,o)=>{const d=document.querySelector(`.card[data-id="${t.id}"]`);d&&(d.title=`Cluster: ${n}, Order: ${o}`,e.setNodeState(t.id,{cluster:n,sortOrder:o}))})}),a<0||a>=d.length)return void console.warn("Invalid cluster index:",a);const s=o(d[a]);for(const t of s)e.setNodeState(t.id,{runStatus:"queued"}),window.updateNodeRunStatusBadge(t);for(const o of s){const n=t(o);document.querySelector(`.card[data-id="${o.id}"]`),e.setNodeState(o.id,{runStatus:"running"}),window.updateNodeRunStatusBadge(o);try{await n.run(),e.setNodeState(o.id,{runStatus:"complete"}),window.updateNodeRunStatusBadge(o)}catch(t){e.setNodeState(o.id,{runStatus:"error"}),window.updateNodeRunStatusBadge(o),console.error(`Error running node ${o.id}:`,t);break}}}},904:(e,t,o)=>{"use strict";var n=o(751),d=o(538);let a=1e4,i=null;function s(){return localStorage.getItem("tokenBucketEstimate")||(console.log("Initializing token bucket estimate in localStorage"),c({userId:"unknown",tokensRemaining:a,lastRefill:Date.now(),maxTokens:a,refillRate:5})),JSON.parse(localStorage.getItem("tokenBucketEstimate"))}function c(e){try{localStorage.setItem("tokenBucketEstimate",JSON.stringify(e))}catch(e){}}function r(e){const t=s();if(t.maxTokens==a&&5==t.refillRate||(e={userId:t.userId||"unknown",tokensRemaining:a,lastRefill:Date.now(),maxTokens:a,refillRate:5}),t&&t.lastRefill>e.lastRefill&&(e=t),window.currentTokenBucketInfo&&!(e.lastRefill>window.currentTokenBucketInfo.lastRefill))return;window.currentTokenBucketInfo=e,i&&(clearTimeout(i),i=null);const o=document.getElementById("tokenBucketBar");if(!o)return;const n=o.querySelector(".tokenBucketBar-fill"),d=o.querySelector(".tokenBucketBar-text");if(!n||!d)return;let r=e.tokensRemaining;const l=e.maxTokens,u=e.refillRate,w=e.lastRefill,m=u;!function t(){const o=Date.now(),a=Math.floor((o-w)/1e3);let s=Math.min(l,r+a*m);const f=Math.max(0,Math.min(1,s/l));n.style.width=100*f+"%",d.textContent=`Tokens: ${Math.floor(s)}/${l}`,c({userId:e.userId,tokensRemaining:s,lastRefill:w,maxTokens:l,refillRate:u}),s<l&&(i=setTimeout(t,1e3))}()}window.currentTokenBucketInfo=null,r(s()),window.updateTokenBucketBar=r;let l=n.G+"/api/refillBucket";document.getElementById("refill-tokens").addEventListener("click",async()=>{try{const e=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":d.J}});let t;const o=e.headers.get("content-type");t=o&&o.includes("application/json")?await e.json():{message:await e.text()},e.ok&&t.tokenBucket?(alert("Tokens refilled!"),r(t.tokenBucket)):alert(t.message||"Refill failed. You may not be whitelisted.")}catch(e){alert("Error contacting server: "+e.message)}})}},t={};function o(n){var d=t[n];if(void 0!==d)return d.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(862),o(457),o(758),o(824),o(79),o(794),o(548),o(690),o(770),o(331),o(751),o(538),o(904),o(72),o(508),o(439),o(235),o(757),o(182),o(695),o(876),o(885),o(438),o(250),o(433)})();