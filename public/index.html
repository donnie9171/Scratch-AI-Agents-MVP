<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="components/DropdownMenu.css" />
    <title>MEW: Multi-Agent Exploration Workbench</title>
  </head>
  <body>
    <button
      id="versionNumber"
      class="version-number"
      onclick="window.open('https://fireworks-studios.gitbook.io/fireworks-studios/mew-multi-agent-exploration-workbench', '_blank')"
    >
      MEW v0.1
    </button>

    <div
      id="top-center-bar"
      style="
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10001;
        gap: 16px;
      "
    >
      <div
        style="
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 16px;
        "
      >
        <button
          id="versionNumber"
          class="version-number"
          onclick="window.open('https://fireworks-studios.gitbook.io/fireworks-studios/mew-multi-agent-exploration-workbench', '_blank')"
        >
          MEW v0.1
        </button>
        <div id="tokenBucketBar" class="tokenBucketBar">
          <div class="tokenBucketBar-fill" style="width: 80%"></div>
          <div class="tokenBucketBar-text">Tokens: 50/1000</div>
        </div>
      </div>
    </div>

    <div id="controls" class="floating-menu">
      <button id="save-nodes" class="button">Save</button>
      <button id="load-nodes" class="button">Load</button>
      <button id="cut" class="button">Cut Mode</button>
      <button
        id="feedback"
        class="button"
        onclick="window.open('https://forms.gle/SoMzCvFDogJDkDAn6', '_blank')"
      >
        Feedback
      </button>
    </div>
    <div id="node-creation-controls" class="floating-menu" style="top: 60px">
      <button id="new-receiver" class="button">Receiver</button>
      <button id="new-agent" class="button">Agent</button>
      <button id="new-broadcaster" class="button">Broadcaster</button>
    </div>
    <div id="tool-creation-controls" class="floating-menu" style="top: 120px">
      <button id="new-variable-tool" class="button">Variable</button>
      <button id="new-notepad-tool" class="button">Notepad</button>
      <button id="new-costume-tool" class="button">Costume</button>
      <button id="new-comment" class="button">Comment</button>
    </div>

    <div id="json-modal">
      <div id="json-modal-content">
        <input
          id="json-modal-project-name"
          type="text"
          placeholder="Project name (for download)"
          style="
            font-size: 1.2em;
            width: 90%;
            padding: 4px;
            border-radius: 6px;
            border: 1px solid #888;
            background: #18192a;
            color: #fff;
            margin-bottom: 10px;
          "
        />
        <textarea id="json-modal-text"></textarea>
        <div id="json-modal-buttons">
          <button id="download-json-modal" class="button">Download JSON</button>
          <button id="copy-json-modal" class="button">Copy</button>
          <button id="close-json-modal" class="button">Close</button>
        </div>
      </div>
    </div>

    <div id="inspector-modal">
      <div id="inspector-content">
        <div id="inspector-header-row">
          <h2 id="inspector-title"></h2>
          <button
            id="run-inspector"
            class="button"
            style="background: #5ac05b; color: #fff"
          >
            Run
          </button>
          <button
            id="delete-inspector"
            class="button"
            style="background: #ff5a5a; color: #fff"
          >
            Delete node
          </button>
          <button id="close-inspector" class="button">Close</button>
        </div>
        <div id="inspector-main-row">
          <div id="inspector-details"></div>
          <div id="inspector-tool-panel"></div>
        </div>
      </div>
    </div>

    <div id="scroll-area">
      <div id="container">
        <canvas id="connections"></canvas>
        <!-- Nodes will be added here dynamically -->
      </div>
    </div>
    <div id="cut-tooltip">
      Cut mode: Click on something to remove it. Press Escape to exit.
    </div>
    <div id="scratch-iframe-bar">
      <button
        id="GreenFlagBtn"
        class="button"
        title="Green Flag"
        style="
          background: #4caf50;
          color: #fff;
          border-radius: 50%;
          width: 36px;
          height: 36px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-flag-icon lucide-flag"><path d="M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528"/></svg>
      </button>
      <button
        id="StopBtn"
        class="button"
        title="Stop"
        style="
          background: #ff5a5a;
          color: #fff;
          border-radius: 50%;
          width: 36px;
          height: 36px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-octagon-icon lucide-octagon"><path d="M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z"/></svg>
      </button>
      <input
        id="scratch-project-id"
        type="text"
        value="scratch.mit.edu/projects/1197188623"
        placeholder="Enter Scratch Project ID or URL"
      />
      <button
        id="goto-scratch-project"
        class="button"
        style="
          color: #fff;
          border-radius: 50%;
          width: 36px;
          height: 36px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        "
        onclick="(function(){
        var input = document.getElementById('scratch-project-id');
        var val = input ? input.value.trim() : '';
        var projectId = val;
        // If user pasted a full URL, extract the project ID
        var match = val.match(/(projects\/|#)(\d+)/);
        if (match) projectId = match[2];
        // Fallback to default if empty
        if (!projectId) projectId = '1197188623';
        var url = 'https://scratch.mit.edu/projects/' + projectId;
        window.open(url, '_blank');
    })()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-square-arrow-out-up-right-icon lucide-square-arrow-out-up-right"
        >
          <path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6" />
          <path d="m21 3-9 9" />
          <path d="M15 3h6v6" />
        </svg>
      </button>
      <button id="load-scratch-project" class="button"
        style="
          color: #fff;
          border-radius: 50%;
          width: 36px;
          height: 36px;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-icon lucide-search"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
      </button>
    </div>
    <iframe
      id="scratch-iframe"
      src="projectPlayer.html#227024526"
      width="503"
      height="377"
      allowtransparency="true"
      frameborder="0"
      scrolling="no"
      allowfullscreen
    >
    </iframe>

    <div
      id="load-project-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        z-index: 10001;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: #212228;
          padding: 20px;
          border-radius: 8px;
          max-width: 90vw;
          max-height: 80vh;
          display: flex;
          flex-direction: column;
        "
      >
        <textarea
          id="load-project-text"
          style="
            background-color: #18192a;
            color: #fff;
            width: 60vw;
            height: 40vh;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 10px;
          "
        ></textarea>
        <div style="display: flex; gap: 10px; justify-content: flex-end">
          <button id="load-project-confirm" class="button">Load</button>
          <button id="close-load-project" class="button">Close</button>
        </div>
      </div>
    </div>

    <script src="bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      window.loadNodes();
    </script>
  </body>
</html>
